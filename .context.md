# Context: Scale Army Job Alert Bot

This file contains background knowledge about the data source, environment, and edge cases the agent needs to understand before writing any code. This is reference material — not instructions.

---

## The Job Board

The job board lives at `https://jobs.ashbyhq.com/Scale%20Army%20Careers`. This URL is a React single-page application and returns a nearly empty HTML shell when fetched directly. The actual job data is loaded by the browser via JavaScript after the page renders. This means the public URL is completely useless for scraping.

Do not attempt to scrape the HTML page. Do not use Playwright, Puppeteer, Selenium, or any headless browser. They are unnecessary and add enormous complexity.

## The Ashby Public API

Ashby (the ATS powering the job board) exposes a free, unauthenticated public REST API for every job board it hosts. This is the correct data source. No API key, no OAuth, no authentication of any kind is required.

The endpoint for this specific board is:

```
GET https://api.ashbyhq.com/posting-api/job-board/Scale%20Army%20Careers
```

Make a live GET request to this endpoint before writing the data-handling code, because the response shape should be treated as the ground truth, not this document. The expected structure is:

```json
{
  "jobs": [
    {
      "id": "abc123",
      "title": "Senior Product Manager",
      "location": "Remote",
      "department": "Product",
      "team": "Growth",
      "isRemote": true,
      "employmentType": "FullTime",
      "publishedAt": "2024-11-01T12:00:00.000Z",
      "jobUrl": "https://jobs.ashbyhq.com/Scale%20Army%20Careers/abc123",
      "applyUrl": "https://jobs.ashbyhq.com/Scale%20Army%20Careers/abc123/application"
    }
  ]
}
```

The field used to uniquely identify a job across polling cycles is `id`. If `id` is absent or `null` in the live response, fall back to a deterministic hash of `title + publishedAt` as the identifier.

## Telegram Bot API

The Telegram Bot API is a simple REST API. Messages are sent via:

```
POST https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage
```

With a JSON body:

```json
{
  "chat_id": "your-chat-id",
  "text": "Your message here",
  "parse_mode": "Markdown",
  "disable_web_page_preview": true
}
```

To get a bot token: the user goes to @BotFather on Telegram, sends `/newbot`, follows the prompts, and receives a token like `7412345678:AAFxyz...`.

To get the chat ID: the user starts a conversation with the bot and visits `https://api.telegram.org/bot{TOKEN}/getUpdates` — the `chat.id` field in the response is their chat ID. If it's a group chat, the ID will be a negative number.

## Telegram Markdown Gotchas

Telegram's "Markdown" mode is not standard Markdown. It supports a limited subset. The characters `_`, `*`, `` ` ``, and `[` have special meaning. If any of these characters appear in raw job data (like a job title with an asterisk), they must be escaped with a backslash or the message send will fail with a parse error.

The safe approach is to escape user-supplied strings before inserting them into the message template. Specifically, replace `*` with `\*` and `_` with `\_` in any field that comes from the API (title, department, team, location).

## The "First Run" Problem

On first run, the API might return dozens of existing jobs. Without special handling, the bot would send a Telegram message for every single one of them — which is spam and would immediately erode the user's trust in the tool.

The correct first-run behaviour: if `jobs.json` does not exist when the bot starts, load all current job IDs, write them to `jobs.json`, log a message explaining what happened, and proceed to the polling loop without sending any Telegram messages. From this point forward, only jobs that appear in API responses _after_ this first run will be announced.

## Employment Type Values

The `employmentType` field from the API uses PascalCase strings. Known values include `FullTime`, `PartTime`, `Contract`, `Intern`. These should be humanised before display — e.g., `FullTime` → `Full-Time`, `PartTime` → `Part-Time`.

## Rate Limits and Politeness

The Ashby public API has no documented rate limit, but the bot should not be configured to poll more frequently than every 5 minutes in practice. The default in the CONFIG block should be 30 minutes. The user can lower it, but they should understand that extremely frequent polling (e.g., every 1 minute) is bad practice and may result in IP blocks.

## Environment Assumptions

The bot is assumed to run on any machine with Python 3.8 or higher installed for local testing. In production, it runs on GitHub Actions' `ubuntu-latest` runner — a fresh, ephemeral Ubuntu VM that is spun up, runs the script once, and is destroyed. No GPU, no cloud services, no special OS configuration is assumed or required.

## Hosting: GitHub Actions

The bot is hosted for free on GitHub Actions. Rather than running as a long-lived process, the script is designed as a **single-run script** — it does one full check and exits. GitHub's built-in cron scheduler triggers it at the configured interval via a workflow file at `.github/workflows/bot.yml`.

The workflow does four things in sequence: it checks out the repository (which pulls down the current `jobs.json` from the repo), installs dependencies, runs `main.py`, and then commits the updated `jobs.json` back to the repo. This commit is how state persists between runs — because each GitHub Actions runner is a fresh machine with no memory of previous executions, the only way to carry `jobs.json` forward is to store it in the repository itself.

This means `jobs.json` will appear in the repository's commit history, updated every time the workflow runs. This is expected and intentional. The file is not sensitive (it contains only job IDs, not credentials) and can be committed publicly without concern.

## GitHub Secrets for Credentials

The Telegram bot token and chat ID must never appear in any file in the repository. Instead, they are stored as **GitHub Secrets** — encrypted values stored by GitHub and injected into the runner as environment variables at runtime. The script reads them with `os.environ.get("TELEGRAM_BOT_TOKEN")`.

To add a secret: go to the repository on GitHub → Settings → Secrets and Variables → Actions → New repository secret. Add `TELEGRAM_BOT_TOKEN` and `TELEGRAM_CHAT_ID` as separate secrets. The workflow references them as `${{ secrets.TELEGRAM_BOT_TOKEN }}` in the `env` block of the job step.

## GitHub Actions Cron Accuracy

GitHub's cron scheduler is not perfectly punctual. Runs can be delayed by anywhere from a few seconds to 15 minutes depending on GitHub's infrastructure load. For a job alert bot, this is completely acceptable — a 10-minute delay on a 30-minute polling interval is meaningless in practice. Do not attempt to work around this with workarounds like self-triggering workflows.
